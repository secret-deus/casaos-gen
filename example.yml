name: coze-studio
x-env-file: &id001
- .env
services:
  mysql:
    image: mysql:8.4.5
    container_name: coze-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_ROOT_PASSWORD:-root}
      MYSQL_DATABASE: ${MYSQL_DATABASE:-opencoze}
      MYSQL_USER: ${MYSQL_USER:-coze}
      MYSQL_PASSWORD: ${MYSQL_PASSWORD:-coze123}
    env_file: *id001
    volumes:
    - ./data/mysql:/var/lib/mysql
    - ./volumes/mysql/schema.sql:/docker-entrypoint-initdb.d/init.sql
    - ./atlas/opencoze_latest_schema.hcl:/opencoze_latest_schema.hcl:ro
    entrypoint:
    - bash
    - -c
    - "/usr/local/bin/docker-entrypoint.sh mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci\
      \ &\nMYSQL_PID=$$!\n\necho 'Waiting for MySQL to start...'\nuntil mysqladmin\
      \ ping -h localhost -u root -p$${MYSQL_ROOT_PASSWORD} --silent 2>/dev/null;\
      \ do\n  echo 'MySQL is starting...'\n  sleep 2\ndone\n\necho 'Waiting for workflow_version\
      \ table to exist...'\nwhile true; do\n  if mysql -h localhost -u root -p$${MYSQL_ROOT_PASSWORD}\
      \ $${MYSQL_DATABASE} -e \"SHOW TABLES LIKE 'workflow_version';\" 2>/dev/null\
      \ | grep -q \"workflow_version\"; then\n    echo 'Found workflow_version table,\
      \ continuing...'\n    break\n  else\n    echo 'workflow_version table not found,\
      \ retrying in 2 seconds...'\n    sleep 2\n  fi\ndone\n\necho 'MySQL is ready,\
      \ installing Atlas CLI...'\n\nif ! command -v atlas >/dev/null 2>&1; then\n\
      \  echo 'Installing Atlas CLI...'\n  curl -sSf https://atlasgo.sh | sh -s --\
      \ -y --community\n  export PATH=$$PATH:/root/.local/bin\nelse\n  echo 'Atlas\
      \ CLI already installed'\nfi\n\nif [ -f '/opencoze_latest_schema.hcl' ]; then\n\
      \  echo 'Running Atlas migrations...'\n  ATLAS_URL=\"mysql://$${MYSQL_USER}:$${MYSQL_PASSWORD}@localhost:3306/$${MYSQL_DATABASE}\"\
      \n  atlas schema apply -u \"$ATLAS_URL\" --to \"file:///opencoze_latest_schema.hcl\"\
      \ --exclude \"atlas_schema_revisions,table_*\" --auto-approve\n  echo 'Atlas\
      \ migrations completed successfully'\nelse\n  echo 'No migrations found'\nfi\n\
      wait $$MYSQL_PID\n"
    healthcheck:
      test:
      - CMD
      - mysqladmin
      - ping
      - -h
      - localhost
      - -u$${MYSQL_USER}
      - -p$${MYSQL_PASSWORD}
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    networks:
    - coze-network
    x-casaos:
      envs:
      - container: MYSQL_ROOT_PASSWORD
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MYSQL_DATABASE
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MYSQL_USER
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MYSQL_PASSWORD
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      ports: []
      volumes:
      - container: /var/lib/mysql
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /docker-entrypoint-initdb.d/init.sql
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /opencoze_latest_schema.hcl
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  redis:
    image: bitnamilegacy/redis:8.0
    container_name: coze-redis
    restart: always
    user: root
    privileged: true
    env_file: *id001
    environment:
    - REDIS_AOF_ENABLED=${REDIS_AOF_ENABLED:-no}
    - REDIS_PORT_NUMBER=${REDIS_PORT_NUMBER:-6379}
    - REDIS_IO_THREADS=${REDIS_IO_THREADS:-4}
    - ALLOW_EMPTY_PASSWORD=${ALLOW_EMPTY_PASSWORD:-yes}
    volumes:
    - ./data/bitnami/redis:/bitnami/redis/data:rw,Z
    command: "bash -c \"\n  /opt/bitnami/scripts/redis/setup.sh\n  # Set proper permissions\
      \ for data directories\n  chown -R redis:redis /bitnami/redis/data\n  chmod\
      \ g+s /bitnami/redis/data\n\n  exec /opt/bitnami/scripts/redis/entrypoint.sh\
      \ /opt/bitnami/scripts/redis/run.sh\n\"\n"
    healthcheck:
      test:
      - CMD
      - redis-cli
      - ping
      interval: 5s
      timeout: 10s
      retries: 10
      start_period: 10s
    networks:
    - coze-network
    x-casaos:
      envs:
      - container: REDIS_AOF_ENABLED
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: REDIS_PORT_NUMBER
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: REDIS_IO_THREADS
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: ALLOW_EMPTY_PASSWORD
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      ports: []
      volumes:
      - container: /bitnami/redis/data
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  elasticsearch:
    image: bitnamilegacy/elasticsearch:8.18.0
    container_name: coze-elasticsearch
    restart: always
    user: root
    privileged: true
    env_file: *id001
    environment:
    - TEST=1
    volumes:
    - ./data/bitnami/elasticsearch:/bitnami/elasticsearch/data
    - ./volumes/elasticsearch/elasticsearch.yml:/opt/bitnami/elasticsearch/config/my_elasticsearch.yml
    - ./volumes/elasticsearch/analysis-smartcn.zip:/opt/bitnami/elasticsearch/analysis-smartcn.zip:rw,Z
    - ./volumes/elasticsearch/setup_es.sh:/setup_es.sh
    - ./volumes/elasticsearch/es_index_schema:/es_index_schema
    healthcheck:
      test:
      - CMD-SHELL
      - curl -f http://localhost:9200 && [ -f /tmp/es_plugins_ready ] && [ -f /tmp/es_init_complete
        ]
      interval: 5s
      timeout: 10s
      retries: 10
      start_period: 10s
    networks:
    - coze-network
    command: "bash -c \"\n  /opt/bitnami/scripts/elasticsearch/setup.sh\n  # Set proper\
      \ permissions for data directories\n  chown -R elasticsearch:elasticsearch /bitnami/elasticsearch/data\n\
      \  chmod g+s /bitnami/elasticsearch/data\n\n  # Create plugin directory\n  mkdir\
      \ -p /bitnami/elasticsearch/plugins;\n\n  # Unzip plugin to plugin directory\
      \ and set correct permissions\n  echo 'Installing smartcn plugin...';\n  if\
      \ [ ! -d /opt/bitnami/elasticsearch/plugins/analysis-smartcn ]; then\n\n   \
      \ # Download plugin package locally\n    echo 'Copying smartcn plugin...';\n\
      \    cp /opt/bitnami/elasticsearch/analysis-smartcn.zip /tmp/analysis-smartcn.zip\n\
      \n    elasticsearch-plugin install file:///tmp/analysis-smartcn.zip\n    if\
      \ [[ \"$$?\" != \"0\" ]]; then\n      echo 'Plugin installation failed, exiting\
      \ operation';\n      rm -rf /opt/bitnami/elasticsearch/plugins/analysis-smartcn\n\
      \      exit 1;\n    fi;\n    rm -f /tmp/analysis-smartcn.zip;\n  fi;\n\n  #\
      \ Create marker file indicating plugin installation success\n  touch /tmp/es_plugins_ready;\n\
      \  echo 'Plugin installation successful, marker file created';\n\n  # Start\
      \ initialization script in background\n  (\n    echo 'Waiting for Elasticsearch\
      \ to be ready...'\n    until curl -s -f http://localhost:9200/_cat/health >/dev/null\
      \ 2>&1; do\n      echo 'Elasticsearch not ready, waiting...'\n      sleep 2\n\
      \    done\n    echo 'Elasticsearch is ready!'\n\n    # Run ES initialization\
      \ script\n    echo 'Running Elasticsearch initialization...'\n    sed 's/\\\
      r$$//' /setup_es.sh > /setup_es_fixed.sh\n    chmod +x /setup_es_fixed.sh\n\
      \    /setup_es_fixed.sh --index-dir /es_index_schema\n    # Create marker file\
      \ indicating initialization completion\n    touch /tmp/es_init_complete\n  \
      \  echo 'Elasticsearch initialization completed successfully!'\n  ) &\n\n  #\
      \ Start Elasticsearch\n  exec /opt/bitnami/scripts/elasticsearch/entrypoint.sh\
      \ /opt/bitnami/scripts/elasticsearch/run.sh\n  echo -e \"\u23F3 Adjusting Elasticsearch\
      \ disk watermark settings...\"\n\"\n"
    x-casaos:
      envs:
      - container: TEST
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      ports: []
      volumes:
      - container: /bitnami/elasticsearch/data
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /opt/bitnami/elasticsearch/config/my_elasticsearch.yml
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /opt/bitnami/elasticsearch/analysis-smartcn.zip
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /setup_es.sh
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /es_index_schema
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  minio:
    image: minio/minio:RELEASE.2025-06-13T11-33-47Z-cpuv1
    container_name: coze-minio
    user: root
    privileged: true
    restart: always
    env_file: *id001
    volumes:
    - ./data/minio:/data
    - ./volumes/minio/default_icon/:/default_icon
    - ./volumes/minio/official_plugin_icon/:/official_plugin_icon
    environment:
      MINIO_ROOT_USER: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_ROOT_PASSWORD: ${MINIO_ROOT_PASSWORD:-minioadmin123}
      MINIO_DEFAULT_BUCKETS: ${STORAGE_BUCKET:-opencoze},${MINIO_DEFAULT_BUCKETS:-milvus}
    entrypoint:
    - /bin/sh
    - -c
    - "# Run initialization in background\n(\n  # Wait for MinIO to be ready\n  until\
      \ (/usr/bin/mc alias set localminio http://localhost:9000 $${MINIO_ROOT_USER}\
      \ $${MINIO_ROOT_PASSWORD}) do\n    echo \"Waiting for MinIO to be ready...\"\
      \n    sleep 1\n  done\n\n  # Create bucket and copy files\n  /usr/bin/mc mb\
      \ --ignore-existing localminio/$${STORAGE_BUCKET}\n  /usr/bin/mc cp --recursive\
      \ /default_icon/ localminio/$${STORAGE_BUCKET}/default_icon/\n  /usr/bin/mc\
      \ cp --recursive /official_plugin_icon/ localminio/$${STORAGE_BUCKET}/official_plugin_icon/\n\
      \n  echo \"MinIO initialization complete.\"\n) &\n\n# Start minio server in\
      \ foreground\nexec minio server /data --console-address \":9001\"\n"
    healthcheck:
      test:
      - CMD-SHELL
      - /usr/bin/mc alias set health_check http://localhost:9000 ${MINIO_ROOT_USER}
        ${MINIO_ROOT_PASSWORD} && /usr/bin/mc ready health_check
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
    - coze-network
    x-casaos:
      envs:
      - container: MINIO_ROOT_USER
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_ROOT_PASSWORD
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_DEFAULT_BUCKETS
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      ports: []
      volumes:
      - container: /data
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /default_icon
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /official_plugin_icon
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  etcd:
    image: bitnamilegacy/etcd:3.5
    container_name: coze-etcd
    user: root
    restart: always
    privileged: true
    env_file: *id001
    environment:
    - ETCD_AUTO_COMPACTION_MODE=revision
    - ETCD_AUTO_COMPACTION_RETENTION=1000
    - ETCD_QUOTA_BACKEND_BYTES=4294967296
    - ALLOW_NONE_AUTHENTICATION=yes
    volumes:
    - ./data/bitnami/etcd:/bitnami/etcd:rw,Z
    - ./volumes/etcd/etcd.conf.yml:/opt/bitnami/etcd/conf/etcd.conf.yml:ro,Z
    command: "bash -c \"\n  /opt/bitnami/scripts/etcd/setup.sh\n  # Set proper permissions\
      \ for data and config directories\n  chown -R etcd:etcd /bitnami/etcd\n  chmod\
      \ g+s /bitnami/etcd\n\n  exec /opt/bitnami/scripts/etcd/entrypoint.sh /opt/bitnami/scripts/etcd/run.sh\n\
      \"\n"
    healthcheck:
      test:
      - CMD
      - etcdctl
      - endpoint
      - health
      interval: 5s
      timeout: 10s
      retries: 10
      start_period: 10s
    networks:
    - coze-network
    x-casaos:
      envs:
      - container: ETCD_AUTO_COMPACTION_MODE
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: ETCD_AUTO_COMPACTION_RETENTION
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: ETCD_QUOTA_BACKEND_BYTES
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: ALLOW_NONE_AUTHENTICATION
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      ports: []
      volumes:
      - container: /bitnami/etcd
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /opt/bitnami/etcd/conf/etcd.conf.yml
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  milvus:
    container_name: coze-milvus
    image: milvusdb/milvus:v2.5.10
    user: root
    privileged: true
    restart: always
    env_file: *id001
    command: "bash -c \"\n  # Set proper permissions for data directories\n  chown\
      \ -R root:root /var/lib/milvus\n  chmod g+s /var/lib/milvus\n\n  exec milvus\
      \ run standalone\n\"\n"
    security_opt:
    - seccomp:unconfined
    environment:
      ETCD_ENDPOINTS: etcd:2379
      MINIO_ADDRESS: minio:9000
      MINIO_BUCKET_NAME: ${MINIO_DEFAULT_BUCKETS:-milvus}
      MINIO_ACCESS_KEY_ID: ${MINIO_ROOT_USER:-minioadmin}
      MINIO_SECRET_ACCESS_KEY: ${MINIO_ROOT_PASSWORD:-minioadmin123}
      MINIO_USE_SSL: false
      LOG_LEVEL: debug
    volumes:
    - ./data/milvus:/var/lib/milvus:rw,Z
    healthcheck:
      test:
      - CMD
      - curl
      - -f
      - http://localhost:9091/healthz
      interval: 5s
      timeout: 10s
      retries: 10
      start_period: 10s
    depends_on:
      etcd:
        condition: service_healthy
      minio:
        condition: service_healthy
    networks:
    - coze-network
    x-casaos:
      envs:
      - container: ETCD_ENDPOINTS
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_ADDRESS
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_BUCKET_NAME
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_ACCESS_KEY_ID
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_SECRET_ACCESS_KEY
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: MINIO_USE_SSL
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: LOG_LEVEL
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      ports: []
      volumes:
      - container: /var/lib/milvus
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  nsqlookupd:
    image: nsqio/nsq:v1.2.1
    container_name: coze-nsqlookupd
    command: /nsqlookupd
    restart: always
    networks:
    - coze-network
    healthcheck:
      test:
      - CMD-SHELL
      - nsqlookupd --version
      interval: 5s
      timeout: 10s
      retries: 10
      start_period: 10s
    x-casaos:
      envs: []
      ports: []
      volumes: []
  nsqd:
    image: nsqio/nsq:v1.2.1
    container_name: coze-nsqd
    command: /nsqd --lookupd-tcp-address=nsqlookupd:4160 --broadcast-address=nsqd
    restart: always
    depends_on:
      nsqlookupd:
        condition: service_healthy
    networks:
    - coze-network
    healthcheck:
      test:
      - CMD-SHELL
      - /nsqd --version
      interval: 5s
      timeout: 10s
      retries: 10
      start_period: 10s
    x-casaos:
      envs: []
      ports: []
      volumes: []
  nsqadmin:
    image: nsqio/nsq:v1.2.1
    container_name: coze-nsqadmin
    command: /nsqadmin --lookupd-http-address=nsqlookupd:4161
    restart: always
    depends_on:
      nsqlookupd:
        condition: service_healthy
    networks:
    - coze-network
    x-casaos:
      envs: []
      ports: []
      volumes: []
  coze-server:
    image: cozedev/coze-studio-server:latest
    restart: always
    container_name: coze-server
    env_file: *id001
    networks:
    - coze-network
    volumes:
    - .env:/app/.env
    - ../backend/conf:/app/resources/conf
    depends_on:
      mysql:
        condition: service_healthy
      redis:
        condition: service_healthy
      elasticsearch:
        condition: service_healthy
      minio:
        condition: service_healthy
      milvus:
        condition: service_healthy
    command:
    - /app/opencoze
    x-casaos:
      envs: []
      ports: []
      volumes:
      - container: /app/.env
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /app/resources/conf
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
  coze-web:
    image: cozedev/coze-studio-web:latest
    container_name: coze-web
    restart: always
    ports:
    - ${WEB_LISTEN_ADDR:-8888}:80
    volumes:
    - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
    - ./nginx/conf.d/default.conf:/etc/nginx/conf.d/default.conf:ro
    depends_on:
    - coze-server
    networks:
    - coze-network
    x-casaos:
      envs: []
      ports:
      - container: '80'
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      volumes:
      - container: /etc/nginx/nginx.conf
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
      - container: /etc/nginx/conf.d/default.conf
        description:
          de_DE: ''
          el_GR: ''
          en_GB: ''
          en_US: ''
          fr_FR: ''
          hr_HR: ''
          it_IT: ''
          ja_JP: ''
          ko_KR: ''
          nb_NO: ''
          pt_PT: ''
          ru_RU: ''
          sv_SE: ''
          tr_TR: ''
          zh_CN: ''
networks:
  coze-network:
    driver: bridge
x-casaos:
  title:
    de_DE: RagFlow
    el_GR: RagFlow
    en_GB: RagFlow
    en_US: RagFlow
    fr_FR: RagFlow
    hr_HR: RagFlow
    it_IT: RagFlow
    ja_JP: RagFlow
    ko_KR: RagFlow
    nb_NO: RagFlow
    pt_PT: RagFlow
    ru_RU: RagFlow
    sv_SE: RagFlow
    tr_TR: RagFlow
    zh_CN: RagFlow
  tagline:
    de_DE: Deep document RAG
    el_GR: Deep document RAG
    en_GB: Deep document RAG
    en_US: Deep document RAG
    fr_FR: Deep document RAG
    hr_HR: Deep document RAG
    it_IT: Deep document RAG
    ja_JP: Deep document RAG
    ko_KR: Deep document RAG
    nb_NO: Deep document RAG
    pt_PT: Deep document RAG
    ru_RU: Deep document RAG
    sv_SE: Deep document RAG
    tr_TR: Deep document RAG
    zh_CN: Deep document RAG
  description:
    de_DE: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    el_GR: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    en_GB: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    en_US: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    fr_FR: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    hr_HR: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    it_IT: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    ja_JP: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    ko_KR: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    nb_NO: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    pt_PT: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    ru_RU: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    sv_SE: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    tr_TR: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
    zh_CN: "\u8FD9\u91CC\u5199\u5E94\u7528\u4ECB\u7ECD\uFF08\u53EF\u4EE5\u5148\u5199\
      \u4E2D\u6587\u6216\u82F1\u6587\uFF0C\u5355\u8BED\u8A00\u4F1A\u81EA\u52A8\u590D\
      \u5236\u5230\u5168\u90E8\u8BED\u8A00\uFF09\u3002\n"
  category: Database
  author: IceWhaleTech
  developer: fromxiaobai
  architectures:
  - amd64
  - arm64
  icon: https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/RagFlow/icon.png
  thumbnail: https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/RagFlow/thumbnail.png
  screenshot_link:
  - https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/RagFlow/screenshot-1.png
  - https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/RagFlow/screenshot-2.png
  - https://cdn.jsdelivr.net/gh/IceWhaleTech/CasaOS-AppStore@main/Apps/RagFlow/screenshot-3.png
  index: /
  main: mysql
  port_map: ''
  scheme: http
